{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style type="text/css">
    /* Dashboard layout */
    .dashboard-container {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .dashboard-card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .dashboard-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    
    .stats-overview {
      grid-column: span 12;
    }
    
    .vehicle-metrics {
      grid-column: span 6;
    }
    
    @media (max-width: 1200px) {
      .vehicle-metrics {
        grid-column: span 12;
      }
    }
    
    .activity-feed {
      grid-column: span 6;
    }
    
    @media (max-width: 1200px) {
      .activity-feed {
        grid-column: span 12;
      }
    }
    
    .chart-container {
      grid-column: span 8;
    }
    
    @media (max-width: 1200px) {
      .chart-container {
        grid-column: span 12;
      }
    }
    
    .problem-devices {
      grid-column: span 4;
    }
    
    @media (max-width: 1200px) {
      .problem-devices {
        grid-column: span 12;
      }
    }
    
    .full-width {
      grid-column: span 12;
    }
    
    /* Card headers */
    .card-header {
      padding: 15px 20px;
      background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
      color: white;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-header h2 {
      margin: 0;
      font-size: 1.1rem;
    }
    
    .card-body {
      padding: 20px;
    }
    
    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .stat-card {
      background: #f8f9fc;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      border-left: 4px solid #4e73df;
      transition: transform 0.2s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-3px);
    }
    
    .stat-card.devices {
      border-left-color: #4e73df;
    }
    
    .stat-card.online {
      border-left-color: #1cc88a;
    }
    
    .stat-card.offline {
      border-left-color: #f6c23e;
    }
    
    .stat-card.tracked {
      border-left-color: #36b9cc;
    }
    
    .stat-card.untracked {
      border-left-color: #858796;
    }
    
    .stat-card.active {
      border-left-color: #1cc88a;
    }
    
    .stat-card.parked {
      border-left-color: #f6c23e;
    }
    
    .stat-card.unknown {
      border-left-color: #858796;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #5a5c69;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: #858796;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Vehicle metrics */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .metric-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      background: #f8f9fc;
      border-radius: 8px;
    }
    
    .metric-icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .metric-icon.active {
      color: #1cc88a;
    }
    
    .metric-icon.idle {
      color: #36b9cc;
    }
    
    .metric-icon.parked {
      color: #f6c23e;
    }
    
    .metric-icon.unknown {
      color: #858796;
    }
    
    .metric-icon.speed {
      color: #e74a3b;
    }
    
    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .metric-label {
      font-size: 0.75rem;
      color: #858796;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-align: center;
    }
    
    /* Activity feed */
    .activity-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .activity-item {
      padding: 15px;
      border-bottom: 1px solid #e3e6f0;
      display: flex;
      align-items: center;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #f8f9fc;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      flex-shrink: 0;
    }
    
    .activity-icon i {
      font-size: 1rem;
      color: #4e73df;
    }
    
    .activity-icon.location i {
      color: #1cc88a;
    }
    
    .activity-icon.device i {
      color: #4e73df;
    }
    
    .activity-icon.speed i {
      color: #e74a3b;
    }
    
    .activity-content {
      flex-grow: 1;
    }
    
    .activity-title {
      font-weight: 600;
      margin-bottom: 3px;
    }
    
    .activity-subtitle {
      font-size: 0.875rem;
      color: #858796;
    }
    
    .activity-time {
      font-size: 0.75rem;
      color: #858796;
      white-space: nowrap;
      margin-left: 10px;
    }
    
    /* Problem devices */
    .problem-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .problem-item {
      padding: 15px;
      border-bottom: 1px solid #e3e6f0;
      display: flex;
      align-items: center;
    }
    
    .problem-item:last-child {
      border-bottom: none;
    }
    
    .problem-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #f8f9fc;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      flex-shrink: 0;
    }
    
    .problem-icon i {
      font-size: 1rem;
      color: #e74a3b;
    }
    
    .problem-content {
      flex-grow: 1;
    }
    
    .problem-title {
      font-weight: 600;
      margin-bottom: 3px;
    }
    
    .problem-subtitle {
      font-size: 0.875rem;
      color: #858796;
    }
    
    /* Action buttons */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .action-button {
      padding: 8px 15px;
      background: #4e73df;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 0.875rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      transition: background 0.2s ease;
      text-decoration: none;
    }
    
    .action-button:hover {
      background: #2e59d9;
      text-decoration: none;
      color: white;
    }
    
    .action-button i {
      margin-right: 8px;
    }
    
    .action-button.secondary {
      background: #858796;
    }
    
    .action-button.secondary:hover {
      background: #717384;
    }
    
    .action-button.success {
      background: #1cc88a;
    }
    
    .action-button.success:hover {
      background: #169b6b;
    }
    
    .action-button.warning {
      background: #f6c23e;
    }
    
    .action-button.warning:hover {
      background: #f4b619;
    }
    
    .action-button.danger {
      background: #e74a3b;
    }
    
    .action-button.danger:hover {
      background: #e02d1b;
    }
    
    /* Auto-refresh indicator */
    .auto-refresh-indicator {
      display: inline-flex;
      align-items: center;
      font-size: 0.8rem;
      color: #858796;
    }
    
    .auto-refresh-indicator.active {
      color: #1cc88a;
    }
    
    .auto-refresh-indicator i {
      margin-right: 5px;
    }
    
    /* Toggle switch for auto-refresh */
    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
      margin-left: 8px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: #1cc88a;
    }
    
    input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    /* Last sync indicator */
    .last-sync {
      font-size: 0.8rem;
      color: #858796;
      margin-right: 15px;
    }
    
    /* Chart container */
    .chart-wrapper {
      width: 100%;
      height: 300px;
      position: relative;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .stats-grid, .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .action-button {
        width: 100%;
      }
    }
  </style>
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize auto-refresh
      let refreshInterval;
      const toggleRefresh = document.getElementById('toggle-refresh');
      const refreshIndicator = document.getElementById('refresh-indicator');
      const countdownEl = document.getElementById('refresh-countdown');
      
      // Initialize from localStorage
      const autoRefreshEnabled = localStorage.getItem('tracking_dashboard_autorefresh') === 'true';
      toggleRefresh.checked = autoRefreshEnabled;
      
      if (autoRefreshEnabled) {
        startAutoRefresh();
        refreshIndicator.classList.add('active');
      }
      
      // Toggle auto-refresh
      toggleRefresh.addEventListener('change', function() {
        if (this.checked) {
          localStorage.setItem('tracking_dashboard_autorefresh', 'true');
          startAutoRefresh();
          refreshIndicator.classList.add('active');
        } else {
          localStorage.setItem('tracking_dashboard_autorefresh', 'false');
          stopAutoRefresh();
          refreshIndicator.classList.remove('active');
          countdownEl.textContent = '';
        }
      });
      
      function startAutoRefresh() {
        // Clear any existing interval
        if (refreshInterval) {
          clearInterval(refreshInterval);
        }
        
        // Set refresh interval (60 seconds)
        let countdown = 60;
        updateCountdown(countdown);
        
        refreshInterval = setInterval(function() {
          countdown--;
          updateCountdown(countdown);
          
          if (countdown <= 0) {
            // Reload the page
            window.location.reload();
          }
        }, 1000);
      }
      
      function stopAutoRefresh() {
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
      }
      
      function updateCountdown(seconds) {
        countdownEl.textContent = seconds + 's';
      }
      
      // Initialize charts
      const hourlyData = JSON.parse('{{ hourly_data|safe }}');
      
      // Active vehicles by hour chart
      const hourlyCtx = document.getElementById('hourlyChart').getContext('2d');
      const hourlyChart = new Chart(hourlyCtx, {
        type: 'line',
        data: {
          labels: hourlyData.map(item => item.hour),
          datasets: [{
            label: 'Active Vehicles',
            data: hourlyData.map(item => item.count),
            backgroundColor: 'rgba(78, 115, 223, 0.1)',
            borderColor: 'rgba(78, 115, 223, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(78, 115, 223, 1)',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(255, 255, 255, 0.8)',
              titleColor: '#6e707e',
              bodyColor: '#6e707e',
              borderColor: '#e3e6f0',
              borderWidth: 1,
              padding: 12,
              displayColors: false,
              callbacks: {
                label: function(context) {
                  return `Active Vehicles: ${context.raw}`;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                precision: 0
              }
            }
          }
        }
      });
      
      // Device status chart
      const statusCtx = document.getElementById('statusChart').getContext('2d');
      const statusChart = new Chart(statusCtx, {
        type: 'doughnut',
        data: {
          labels: ['Online', 'Offline', 'Inactive', 'Unknown'],
          datasets: [{
            data: [
              {{ online_devices }}, 
              {{ offline_devices }}, 
              {{ inactive_devices|default:"0" }}, 
              {{ unknown_devices|default:"0" }}
            ],
            backgroundColor: [
              'rgba(28, 200, 138, 0.8)',
              'rgba(246, 194, 62, 0.8)',
              'rgba(133, 135, 150, 0.8)',
              'rgba(231, 74, 59, 0.8)'
            ],
            borderColor: [
              'rgba(28, 200, 138, 1)',
              'rgba(246, 194, 62, 1)',
              'rgba(133, 135, 150, 1)',
              'rgba(231, 74, 59, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                  size: 12
                }
              }
            }
          }
        }
      });
      
      // Vehicle status chart
      const vehicleStatusCtx = document.getElementById('vehicleStatusChart').getContext('2d');
      const vehicleStatusChart = new Chart(vehicleStatusCtx, {
        type: 'doughnut',
        data: {
          labels: ['Active', 'Parked', 'Unknown'],
          datasets: [{
            data: [
              {{ active_vehicles }}, 
              {{ parked_vehicles }}, 
              {{ unknown_status|default:"0" }}
            ],
            backgroundColor: [
              'rgba(28, 200, 138, 0.8)',
              'rgba(246, 194, 62, 0.8)',
              'rgba(133, 135, 150, 0.8)'
            ],
            borderColor: [
              'rgba(28, 200, 138, 1)',
              'rgba(246, 194, 62, 1)',
              'rgba(133, 135, 150, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                  size: 12
                }
              }
            }
          }
        }
      });
      
      // Quick sync action
      window.quickSync = function(url) {
        fetch(url, {
          method: 'POST',
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          if (response.ok) {
            // Reload after successful sync
            window.location.reload();
          } else {
            alert('Sync failed. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Sync failed. Please try again.');
        });
      }
    });
  </script>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
  &rsaquo; <a href="{% url 'admin:app_list' app_label=app_label %}">{{ app_label|capfirst }}</a>
  &rsaquo; GPS Tracking Dashboard
</div>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- Header with auto-refresh controls -->
  <div class="full-width">
    <div class="card-header">
      <h2>GPS Tracking Dashboard</h2>
      <div class="d-flex align-items-center">
        {% if last_sync %}
        <span class="last-sync">
          <i class="fas fa-history"></i> Last sync: {{ last_sync|timesince }} ago
        </span>
        {% endif %}
        <div class="auto-refresh-indicator" id="refresh-indicator">
          <i class="fas fa-sync-alt"></i> Auto-refresh
          <span id="refresh-countdown"></span>
          <label class="switch">
            <input type="checkbox" id="toggle-refresh">
            <span class="slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Device & Vehicle Stats Overview -->
  <div class="stats-overview dashboard-card">
    <div class="card-header">
      <h2><i class="fas fa-tachometer-alt"></i> System Overview</h2>
    </div>
    <div class="card-body">
      <div class="stats-grid">
        <div class="stat-card devices">
          <div class="stat-value">{{ total_devices }}</div>
          <div class="stat-label">Total Devices</div>
        </div>
        <div class="stat-card online">
          <div class="stat-value">{{ online_devices }}</div>
          <div class="stat-label">Online</div>
        </div>
        <div class="stat-card offline">
          <div class="stat-value">{{ offline_devices }}</div>
          <div class="stat-label">Offline</div>
        </div>
        <div class="stat-card tracked">
          <div class="stat-value">{{ tracked_vehicles }}</div>
          <div class="stat-label">Tracked Vehicles</div>
        </div>
        <div class="stat-card untracked">
          <div class="stat-value">{{ untracked_vehicles }}</div>
          <div class="stat-label">Untracked Vehicles</div>
        </div>
      </div>
      
      <div class="action-buttons">
        {% csrf_token %}
        <button onclick="quickSync('{% url 'admin:sync_all_devices' %}')" class="action-button success">
          <i class="fas fa-sync-alt"></i> Sync All Devices
        </button>
        <a href="{% url 'admin:geolocation_airotrackdevice_changelist' %}" class="action-button">
          <i class="fas fa-satellite-dish"></i> Manage Devices
        </a>
        <a href="{% url 'admin:geolocation_vehiclelocation_changelist' %}" class="action-button">
          <i class="fas fa-map-marker-alt"></i> View Locations
        </a>
        <a href="{% url 'admin:tracking_map_admin' %}" class="action-button">
          <i class="fas fa-map"></i> Live Map
        </a>
        <a href="{% url 'tracking_dashboard' %}" class="action-button secondary" target="_blank">
          <i class="fas fa-external-link-alt"></i> User Dashboard
        </a>
      </div>
    </div>
  </div>
  
  <!-- Vehicle Metrics -->
  <div class="vehicle-metrics dashboard-card">
    <div class="card-header">
      <h2><i class="fas fa-car"></i> Vehicle Status</h2>
    </div>
    <div class="card-body">
      <div class="metrics-grid">
        <div class="metric-item">
          <div class="metric-icon active">
            <i class="fas fa-car"></i>
          </div>
          <div class="metric-value">{{ active_vehicles }}</div>
          <div class="metric-label">Active</div>
        </div>
        <div class="metric-item">
          <div class="metric-icon idle">
            <i class="fas fa-clock"></i>
          </div>
          <div class="metric-value">{{ idle_vehicles }}</div>
          <div class="metric-label">Idle</div>
        </div>
        <div class="metric-item">
          <div class="metric-icon parked">
            <i class="fas fa-parking"></i>
          </div>
          <div class="metric-value">{{ parked_vehicles }}</div>
          <div class="metric-label">Parked</div>
        </div>
        <div class="metric-item">
          <div class="metric-icon unknown">
            <i class="fas fa-question-circle"></i>
          </div>
          <div class="metric-value">{{ unknown_status|default:"0" }}</div>
          <div class="metric-label">Unknown</div>
        </div>
        <div class="metric-item">
          <div class="metric-icon speed">
            <i class="fas fa-tachometer-alt"></i>
          </div>
          <div class="metric-value">{{ avg_speed|floatformat:1 }}</div>
          <div class="metric-label">Avg Speed (km/h)</div>
        </div>
      </div>
      
      <div class="chart-wrapper" style="margin-top: 20px;">
        <canvas id="vehicleStatusChart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- Device Status -->
  <div class="vehicle-metrics dashboard-card">
    <div class="card-header">
      <h2><i class="fas fa-satellite-dish"></i> Device Status</h2>
    </div>
    <div class="card-body">
      <div class="metrics-grid">
        <div class="metric-item">
          <div class="metric-icon active">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="metric-value">{{ online_devices }}</div>
          <div class="metric-label">Online</div>
        </div>
        <div class="metric-item">
          <div class="metric-icon parked">
            <i class="fas fa-exclamation-circle"></i>
          </div>
          <div class="metric-value">{{ offline_devices }}</div>
          <div class="metric-label">Offline</div>
        </div>
        <div class="metric-item">
          <div class="metric-icon unknown">
            <i class="fas fa-question-circle"></i>
          </div>
          <div class="metric-value">{{ unknown_devices|default:"0" }}</div>
          <div class="metric-label">Unknown</div>
        </div>
        <div class="metric-item">
          <div class="metric-icon speed">
            <i class="fas fa-unlink"></i>
          </div>
          <div class="metric-value">{{ inactive_devices|default:"0" }}</div>
          <div class="metric-label">Inactive</div>
        </div>
      </div>
      
      <div class="chart-wrapper" style="margin-top: 20px;">
        <canvas id="statusChart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- Recent Activity -->
  <div class="activity-feed dashboard-card">
    <div class="card-header">
      <h2><i class="fas fa-history"></i> Recent Activity</h2>
    </div>
    <div class="card-body">
      {% if recent_history %}
        <ul class="activity-list">
          {% for history in recent_history %}
            <li class="activity-item">
              {% if history.speed > 5 %}
                <div class="activity-icon speed">
                  <i class="fas fa-tachometer-alt"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-title">{{ history.vehicle.license_plate }} - Moving</div>
                  <div class="activity-subtitle">Speed: {{ history.speed|floatformat:1 }} km/h</div>
                </div>
              {% else %}
                <div class="activity-icon location">
                  <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="activity-content">
                  <div class="activity-title">{{ history.vehicle.license_plate }}</div>
                  <div class="activity-subtitle">{{ history.address|default:"Unknown location"|truncatechars:40 }}</div>
                </div>
              {% endif %}
              <span class="activity-time">{{ history.device_time|timesince }} ago</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No recent activity recorded.</p>
      {% endif %}
      
      <div class="action-buttons">
        <a href="{% url 'admin:geolocation_locationhistory_changelist' %}" class="action-button">
          <i class="fas fa-history"></i> View All History
        </a>
      </div>
    </div>
  </div>
  
  <!-- Chart: Active Vehicles by Hour -->
  <div class="chart-container dashboard-card">
    <div class="card-header">
      <h2><i class="fas fa-chart-line"></i> Active Vehicles (Last 24 Hours)</h2>
    </div>
    <div class="card-body">
      <div class="chart-wrapper">
        <canvas id="hourlyChart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- Problem Devices -->
  <div class="problem-devices dashboard-card">
    <div class="card-header">
      <h2><i class="fas fa-exclamation-triangle"></i> Problem Devices</h2>
    </div>
    <div class="card-body">
      {% if problem_devices %}
        <ul class="problem-list">
          {% for device in problem_devices %}
            <li class="problem-item">
              <div class="problem-icon">
                <i class="fas fa-exclamation-circle"></i>
              </div>
              <div class="problem-content">
                <div class="problem-title">{{ device.name|default:device.device_id }}</div>
                <div class="problem-subtitle">
                  {% if device.vehicle %}
                    {{ device.vehicle.license_plate }}
                  {% else %}
                    Not assigned
                  {% endif %}
                  - {{ device.get_status_display }}
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No problem devices detected.</p>
      {% endif %}
      
      <div class="action-buttons">
        <a href="{% url 'admin:geolocation_airotrackdevice_changelist' %}?status=offline" class="action-button warning">
          <i class="fas fa-wrench"></i> Fix Offline Devices
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
